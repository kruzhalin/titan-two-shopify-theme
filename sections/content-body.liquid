{{ 'section-content-body.css' | asset_url | stylesheet_tag }}

<div class="content-body-section py-20 bg-dark-accent">
  <div class="container mx-auto px-4">
    <div class="max-w-4xl mx-auto">
      <div class="grid grid-cols-1 lg:grid-cols-4 gap-12">
        <!-- Table of Contents (if enabled) -->
        {% if section.settings.show_toc %}
          <div class="lg:col-span-1">
            <div class="toc-sidebar sticky top-8">
              <h3 class="text-lg font-semibold mb-4 text-white">Table of Contents</h3>
              <nav class="toc-nav">
                <ul class="space-y-2">
                  <!-- TOC will be generated by JavaScript -->
                </ul>
              </nav>
            </div>
          </div>
        {% endif %}
        
        <!-- Main Content -->
        <div class="{% if section.settings.show_toc %}lg:col-span-3{% else %}col-span-full{% endif %}">
          <div class="content-wrapper">
            {% if section.settings.content != blank %}
              <div class="prose prose-lg prose-invert max-w-none">
                {{ section.settings.content }}
              </div>
            {% else %}
              <div class="prose prose-lg prose-invert max-w-none">
                {{ page.content }}
              </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Generate Table of Contents
  const tocNav = document.querySelector('.toc-nav ul');
  if (tocNav) {
    const headings = document.querySelectorAll('.content-wrapper h2, .content-wrapper h3, .content-wrapper h4');
    
    headings.forEach((heading, index) => {
      // Add ID to heading
      const id = heading.textContent.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/^-|-$/g, '');
      heading.id = id;
      
      // Create TOC item
      const li = document.createElement('li');
      const a = document.createElement('a');
      a.href = `#${id}`;
      a.textContent = heading.textContent;
      a.className = `text-gray-400 hover:text-accent transition-colors duration-300 block py-1 ${
        heading.tagName === 'H3' ? 'pl-4' : heading.tagName === 'H4' ? 'pl-8' : ''
      }`;
      
      li.appendChild(a);
      tocNav.appendChild(li);
    });
  }
  
  // Smooth scrolling for TOC links
  document.querySelectorAll('.toc-nav a').forEach(link => {
    link.addEventListener('click', function(e) {
      e.preventDefault();
      const target = document.querySelector(this.getAttribute('href'));
      if (target) {
        target.scrollIntoView({
          behavior: 'smooth',
          block: 'start'
        });
      }
    });
  });
});
</script>

{% schema %}
{
  "name": "Content Body Section",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "richtext",
      "id": "content",
      "label": "Content",
      "info": "Leave blank to use page content"
    },
    {
      "type": "checkbox",
      "id": "show_toc",
      "label": "Show Table of Contents",
      "default": false
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 10,
      "unit": "px",
      "label": "Padding Top",
      "default": 40
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 10,
      "unit": "px",
      "label": "Padding Bottom",
      "default": 80
    }
  ],
  "presets": [
    {
      "name": "Content Body Section"
    }
  ]
}
{% endschema %}
